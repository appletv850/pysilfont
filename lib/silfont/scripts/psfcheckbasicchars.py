#!/usr/bin/env python
__doc__ = '''Checks a UFO for the presence of glyphs that represent the
Recommended characters for Non-Roman fonts and warns if any are missing.
http://scriptsource.org/entry/gg5wm9hhd3'''
__url__ = 'http://github.com/silnrsi/pysilfont'
__copyright__ = 'Copyright (c) 2018 SIL International (http://www.sil.org)'
__license__ = 'Released under the MIT License (http://opensource.org/licenses/MIT)'
__author__ = 'Victor Gaultney'

from silfont.core import execute

argspec = [
    ('ifont',{'help': 'Input font file'}, {'type': 'infont'}),
    ('-r', '--rtl', {'help': 'Also include characters just for RTL scripts', 'action': 'store_true'}, {}),
    ('-l','--log',{'help': 'Log file'}, {'type': 'outfile', 'def': '_checkbasicchars.log'})]

basicchars = {
    '0020': 'space',
    '0021': 'exclam',
    '0022': 'quotedbl',
    '0023': 'numbersign',
    '0024': 'dollar',
    '0025': 'percent',
    '0026': 'ampersand',
    '0027': 'quotesingle',
    '0028': 'parenleft',
    '0029': 'parenright',
    '002A': 'asterisk',
    '002B': 'plus',
    '002C': 'comma',
    '002D': 'hyphen',
    '002E': 'period',
    '002F': 'slash',
    '0030': 'zero',
    '0031': 'one',
    '0032': 'two',
    '0033': 'three',
    '0034': 'four',
    '0035': 'five',
    '0036': 'six',
    '0037': 'seven',
    '0038': 'eight',
    '0039': 'nine',
    '003A': 'colon',
    '003B': 'semicolon',
    '003C': 'less',
    '003D': 'equal',
    '003E': 'greater',
    '003F': 'question',
    '0040': 'at',
    '0041': 'A',
    '0042': 'B',
    '0043': 'C',
    '0044': 'D',
    '0045': 'E',
    '0046': 'F',
    '0047': 'G',
    '0048': 'H',
    '0049': 'I',
    '004A': 'J',
    '004B': 'K',
    '004C': 'L',
    '004D': 'M',
    '004E': 'N',
    '004F': 'O',
    '0050': 'P',
    '0051': 'Q',
    '0052': 'R',
    '0053': 'S',
    '0054': 'T',
    '0055': 'U',
    '0056': 'V',
    '0057': 'W',
    '0058': 'X',
    '0059': 'Y',
    '005A': 'Z',
    '005B': 'bracketleft',
    '005C': 'backslash',
    '005D': 'bracketright',
    '005E': 'asciicircum',
    '005F': 'underscore',
    '0060': 'grave',
    '0061': 'a',
    '0062': 'b',
    '0063': 'c',
    '0064': 'd',
    '0065': 'e',
    '0066': 'f',
    '0067': 'g',
    '0068': 'h',
    '0069': 'i',
    '006A': 'j',
    '006B': 'k',
    '006C': 'l',
    '006D': 'm',
    '006E': 'n',
    '006F': 'o',
    '0070': 'p',
    '0071': 'q',
    '0072': 'r',
    '0073': 's',
    '0074': 't',
    '0075': 'u',
    '0076': 'v',
    '0077': 'w',
    '0078': 'x',
    '0079': 'y',
    '007A': 'z',
    '007B': 'braceleft',
    '007C': 'bar',
    '007D': 'braceright',
    '007E': 'asciitilde',
    '00A0': 'uni00A0',
    '00A1': 'exclamdown',
    '00A2': 'cent',
    '00A3': 'sterling',
    '00A4': 'currency',
    '00A5': 'yen',
    '00A6': 'brokenbar',
    '00A7': 'section',
    '00A8': 'dieresis',
    '00A9': 'copyright',
    '00AA': 'ordfeminine',
    '00AB': 'guillemotleft',
    '00AC': 'logicalnot',
    '00AD': 'uni00AD',
    '00AE': 'registered',
    '00AF': 'macron',
    '00B0': 'degree',
    '00B1': 'plusminus',
    '00B2': 'twosuperior',
    '00B3': 'threesuperior',
    '00B4': 'acute',
    '00B5': 'mu',
    '00B6': 'paragraph',
    '00B7': 'periodcentered',
    '00B8': 'cedilla',
    '00B9': 'onesuperior',
    '00BA': 'ordmasculine',
    '00BB': 'guillemotright',
    '00BC': 'onequarter',
    '00BD': 'onehalf',
    '00BE': 'threequarters',
    '00BF': 'questiondown',
    '00C0': 'Agrave',
    '00C1': 'Aacute',
    '00C2': 'Acircumflex',
    '00C3': 'Atilde',
    '00C4': 'Adieresis',
    '00C5': 'Aring',
    '00C6': 'AE',
    '00C7': 'Ccedilla',
    '00C8': 'Egrave',
    '00C9': 'Eacute',
    '00CA': 'Ecircumflex',
    '00CB': 'Edieresis',
    '00CC': 'Igrave',
    '00CD': 'Iacute',
    '00CE': 'Icircumflex',
    '00CF': 'Idieresis',
    '00D0': 'Eth',
    '00D1': 'Ntilde',
    '00D2': 'Ograve',
    '00D3': 'Oacute',
    '00D4': 'Ocircumflex',
    '00D5': 'Otilde',
    '00D6': 'Odieresis',
    '00D7': 'multiply',
    '00D8': 'Oslash',
    '00D9': 'Ugrave',
    '00DA': 'Uacute',
    '00DB': 'Ucircumflex',
    '00DC': 'Udieresis',
    '00DD': 'Yacute',
    '00DE': 'Thorn',
    '00DF': 'germandbls',
    '00E0': 'agrave',
    '00E1': 'aacute',
    '00E2': 'acircumflex',
    '00E3': 'atilde',
    '00E4': 'adieresis',
    '00E5': 'aring',
    '00E6': 'ae',
    '00E7': 'ccedilla',
    '00E8': 'egrave',
    '00E9': 'eacute',
    '00EA': 'ecircumflex',
    '00EB': 'edieresis',
    '00EC': 'igrave',
    '00ED': 'iacute',
    '00EE': 'icircumflex',
    '00EF': 'idieresis',
    '00F0': 'eth',
    '00F1': 'ntilde',
    '00F2': 'ograve',
    '00F3': 'oacute',
    '00F4': 'ocircumflex',
    '00F5': 'otilde',
    '00F6': 'odieresis',
    '00F7': 'divide',
    '00F8': 'oslash',
    '00F9': 'ugrave',
    '00FA': 'uacute',
    '00FB': 'ucircumflex',
    '00FC': 'udieresis',
    '00FD': 'yacute',
    '00FE': 'thorn',
    '00FF': 'ydieresis',
    '0131': 'dotlessi',
    '0152': 'OE',
    '0153': 'oe',
    '0160': 'Scaron',
    '0161': 'scaron',
    '0178': 'Ydieresis',
    '017D': 'Zcaron',
    '017E': 'zcaron',
    '0192': 'florin',
    '02C6': 'circumflex',
    '02C7': 'caron',
    '02D0': 'uni02D0',
    '02D8': 'breve',
    '02D9': 'dotaccent',
    '02DA': 'ring',
    '02DB': 'ogonek',
    '02DC': 'tilde',
    '02DD': 'hungarumlaut',
    '034F': 'uni034F',
    '03C0': 'pi',
    '2000': 'uni2000',
    '2001': 'uni2001',
    '2002': 'uni2002',
    '2003': 'uni2003',
    '2004': 'uni2004',
    '2005': 'uni2005',
    '2006': 'uni2006',
    '2007': 'uni2007',
    '2008': 'uni2008',
    '2009': 'uni2009',
    '200A': 'uni200A',
    '200B': 'uni200B',
    '200C': 'uni200C',
    '200D': 'uni200D',
    '2010': 'uni2010',
    '2011': 'uni2011',
    '2012': 'figuredash',
    '2013': 'endash',
    '2014': 'emdash',
    '2015': 'uni2015',
    '2018': 'quoteleft',
    '2019': 'quoteright',
    '201A': 'quotesinglbase',
    '201C': 'quotedblleft',
    '201D': 'quotedblright',
    '201E': 'quotedblbase',
    '2020': 'dagger',
    '2021': 'daggerdbl',
    '2022': 'bullet',
    '2026': 'ellipsis',
    '2027': 'uni2027',
    '2028': 'uni2028',
    '2029': 'uni2029',
    '202F': 'uni202F',
    '2030': 'perthousand',
    '2039': 'guilsinglleft',
    '203A': 'guilsinglright',
    '2044': 'fraction',
    '2060': 'uni2060',
    '20AC': 'Euro',
    '2122': 'trademark',
    '2126': 'Omega',
    '2202': 'partialdiff',
    '2206': 'Delta',
    '220F': 'product',
    '2211': 'summation',
    '2219': 'uni2219',
    '221A': 'radical',
    '221E': 'infinity',
    '222B': 'integral',
    '2248': 'approxequal',
    '2260': 'notequal',
    '2264': 'lessequal',
    '2265': 'greaterequal',
    '25CA': 'lozenge',
    '25CC': 'uni25CC',
    'FB01': 'fi',
    'FB02': 'fl',
    'FE00': 'uniFE00',
    'FE01': 'uniFE01',
    'FE02': 'uniFE02',
    'FE03': 'uniFE03',
    'FE04': 'uniFE04',
    'FE05': 'uniFE05',
    'FE06': 'uniFE06',
    'FE07': 'uniFE07',
    'FE08': 'uniFE08',
    'FE09': 'uniFE09',
    'FE0A': 'uniFE0A',
    'FE0B': 'uniFE0B',
    'FE0C': 'uniFE0C',
    'FE0D': 'uniFE0D',
    'FE0E': 'uniFE0E',
    'FE0F': 'uniFE0F',
    'FEFF': 'uniFEFF',
    'FFFC': 'uniFFFC',
    'FFFD': 'uniFFFD'
}

basicRTLchars = {
    '200E': 'uni200E',
    '200F': 'uni200F',
    '202A': 'uni202A',
    '202B': 'uni202B',
    '202C': 'uni202C',
    '202D': 'uni202D',
    '202E': 'uni202E',
}

def doit(args) :
    font = args.ifont
    logger = args.logger
    if args.rtl:
        basicchars.update(basicRTLchars)

    glyphlist = font.deflayer.keys()

    for glyphn in glyphlist :
        glyph = font.deflayer[glyphn]
        unival = ''
        if len(glyph["unicode"]) == 1 :
            unival = glyph["unicode"][0].hex
            if unival in basicchars.keys():
                del basicchars[unival]

    for (usv, psname) in sorted(basicchars.items()):
        logger.log(usv + " has no representative glyph (" + psname + ")")

    return

def cmd() : execute("UFO",doit,argspec)
if __name__ == "__main__": cmd()
